//compressor: http://refresh-sf.com/yui/
/**
 * snowman-html5-canvasapi- HTML5 canvas api for snowman.
 * http://code.google.com/p/snowman/
 *
 * Copyright (C) 2013 Bernard Ladenthin <bernard.ladenthin@gmail.com>
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
function getSnowmanHtml5Canvasapi(){snowmanHtml5Canvasapi={bDebugLog:false,data:{canvas:false,liveviewLastSeconds:0,liveviewLastMillis:0}};
snowmanHtml5Canvasapi.debugLog=function(a){if(snowmanHtml5Canvasapi.bDebugLog){console.log(a)}};snowmanHtml5Canvasapi.enableDebugLog=function(){snowmanHtml5Canvasapi.bDebugLog=true
};snowmanHtml5Canvasapi.disableDebugLog=function(){snowmanHtml5Canvasapi.bDebugLog=false};snowmanHtml5Canvasapi.getCanvas=function(){return snowmanHtml5Canvasapi.data.canvas
};snowmanHtml5Canvasapi.setCanvas=function(a){snowmanHtml5Canvasapi.data.canvas=a};snowmanHtml5Canvasapi.parseResponseHeaders=function(f){var h={};
if(!f){return h}var g=f.split("\u000d\u000a");for(var d=0;d<g.length;d++){var e=g[d];var c=e.indexOf("\u003a\u0020");
if(c>0){var b=e.substring(0,c);var a=e.substring(c+2);h[b]=a}}return h};snowmanHtml5Canvasapi.initCanvas=function(){canvas=snowmanHtml5Canvasapi.getCanvas();
if(canvas[0].getContext){width=250;height=250;canvas[0].width=width;canvas[0].height=height;var a=canvas[0].getContext("2d");
a.moveTo(0,0);a.lineTo(width,height);a.stroke();a.fillStyle="black";a.strokeRect(0,0,width,height)}};
snowmanHtml5Canvasapi.fetchImage=function(b,a,c){time=new Date();timestamp=time.getTime();data="name="+b+"&t="+timestamp+"&base64=true";
if(c&&c.length>0){data+=c}jQuery.ajax({type:"GET",url:a,data:data,dataType:"text",success:snowmanHtml5Canvasapi.successCb,error:snowmanHtml5Canvasapi.errorCb,complete:snowmanHtml5Canvasapi.completeCb})
};snowmanHtml5Canvasapi.successCb=function(c,e,b){snowmanHtml5Canvasapi.debugLog("call snowmanHtml5Canvasapi.successCb");
snowmanHtml5Canvasapi.debugLog(e);snowmanHtml5Canvasapi.debugLog(b);snowmanHtml5Canvasapi.debugLog(b.getAllResponseHeaders());
header=snowmanHtml5Canvasapi.parseResponseHeaders(b.getAllResponseHeaders());snowmanHtml5Canvasapi.debugLog(header);
seconds=parseInt(header["snowman-timeseconds"]);millis=parseInt(header["snowman-timemillis"]);snowmanHtml5Canvasapi.debugLog(seconds);
snowmanHtml5Canvasapi.debugLog(millis);snowmanHtml5Canvasapi.debugLog(snowmanHtml5Canvasapi.data.liveviewLastSeconds);
snowmanHtml5Canvasapi.debugLog(snowmanHtml5Canvasapi.data.liveviewLastMillis);hit=false;if(snowmanHtml5Canvasapi.data.liveviewLastSeconds<seconds){hit=true
}else{if(snowmanHtml5Canvasapi.data.liveviewLastSeconds==seconds&&snowmanHtml5Canvasapi.data.liveviewLastMillis<millis){hit=true
}else{if(isNaN(seconds)||isNaN(millis)){seconds=millis=0;hit=true}}}if(hit){snowmanHtml5Canvasapi.data.liveviewLastSeconds=seconds;
snowmanHtml5Canvasapi.data.liveviewLastMillis=millis;snowmanHtml5Canvasapi.debugLog("hit");var a=snowmanHtml5Canvasapi.getCanvas();
if(a[0].getContext){var d=new Image();d.src="data:image/jpeg;base64,"+c;d.onload=function(){a[0].width=d.naturalWidth;
a[0].height=d.naturalHeight;var f=a[0].getContext("2d");f.drawImage(d,0,0)}}}else{snowmanHtml5Canvasapi.debugLog("miss")
}};snowmanHtml5Canvasapi.errorCb=function(a,c,b){snowmanHtml5Canvasapi.debugLog("call liveviewErrorCb");
snowmanHtml5Canvasapi.debugLog(a);snowmanHtml5Canvasapi.debugLog(c);snowmanHtml5Canvasapi.debugLog(b)
};snowmanHtml5Canvasapi.completeCb=function(a,b){snowmanHtml5Canvasapi.debugLog("call liveviewCompleteCb");
snowmanHtml5Canvasapi.debugLog(a);snowmanHtml5Canvasapi.debugLog(b)};return snowmanHtml5Canvasapi};

