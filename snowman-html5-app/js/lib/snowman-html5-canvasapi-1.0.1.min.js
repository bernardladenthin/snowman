//compressor: http://gpbmike.github.io/refresh-sf/
/**
 * snowman-html5-canvasapi- HTML5 canvas api for snowman.
 * https://github.com/bernardladenthin/snowman
 *
 * Copyright (C) 2013 Bernard Ladenthin <bernard.ladenthin@gmail.com>
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
function getSnowmanHtml5Canvasapi(){"use strict";var e={bDebugLog:!1,data:{canvas:!1,liveviewLastSeconds:0,liveviewLastMillis:0}};return e.debugLog=function(a){e.bDebugLog&&console.log(a)},e.enableDebugLog=function(){e.bDebugLog=!0},e.disableDebugLog=function(){e.bDebugLog=!1},e.getCanvas=function(){return e.data.canvas},e.setCanvas=function(a){e.data.canvas=a},e.parseResponseHeaders=function(e){var a,t,s,n,o,g,i;if(a={},t=e.split("\r\n"),!e)return a;for(i=0;i<t.length;i+=1)s=t[i],n=s.indexOf(": "),n>0&&(o=s.substring(0,n),g=s.substring(n+2),a[o]=g);return a},e.initCanvas=function(){var a,t,s,n=e.getCanvas();n[0].getContext&&(a=250,t=250,n[0].width=a,n[0].height=t,s=n[0].getContext("2d"),s.moveTo(0,0),s.lineTo(a,t),s.stroke(),s.fillStyle="black",s.strokeRect(0,0,a,t))},e.fetchImage=function(a,t,s){var n,o,g;n=new Date,o=n.getTime(),g="name="+a+"&t="+o+"&base64=true",s&&s.length>0&&(g+=s),jQuery.ajax({type:"GET",url:t,data:g,dataType:"text",success:e.successCb,error:e.errorCb,complete:e.completeCb})},e.successCb=function(a,t,s){var n,o,g,i,u,l,d;e.debugLog("call snowmanHtml5Canvasapi.successCb"),e.debugLog(t),e.debugLog(s),e.debugLog(s.getAllResponseHeaders()),n=e.parseResponseHeaders(s.getAllResponseHeaders()),e.debugLog(n),o=parseInt(n["snowman-timeseconds"],10),g=parseInt(n["snowman-timemillis"],10),e.debugLog(o),e.debugLog(g),e.debugLog(e.data.liveviewLastSeconds),e.debugLog(e.data.liveviewLastMillis),i=!1,e.data.liveviewLastSeconds<o?i=!0:e.data.liveviewLastSeconds===o&&e.data.liveviewLastMillis<g?i=!0:(isNaN(o)||isNaN(g))&&(o=g=0,i=!0),i?(e.data.liveviewLastSeconds=o,e.data.liveviewLastMillis=g,e.debugLog("hit"),d=e.getCanvas(),d[0].getContext&&(u=new Image,u.src="data:image/jpeg;base64,"+a,u.onload=function(){d[0].width=u.naturalWidth,d[0].height=u.naturalHeight,l=d[0].getContext("2d"),l.drawImage(u,0,0)})):e.debugLog("miss")},e.errorCb=function(a,t,s){e.debugLog("call liveviewErrorCb"),e.debugLog(a),e.debugLog(t),e.debugLog(s)},e.completeCb=function(a,t){e.debugLog("call liveviewCompleteCb"),e.debugLog(a),e.debugLog(t)},e}

